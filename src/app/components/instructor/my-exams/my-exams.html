<div class="my-exams-page">
  <!-- Floating decorative elements -->
  <div class="floating-element element-1">üìù</div>
  <div class="floating-element element-2">üìö</div>
  <div class="floating-element element-3">‚≠ê</div>
  <div class="floating-element element-4">üí°</div>
  
  <header class="page-header">
    <app-back-button></app-back-button>
    <div class="header-content">
      <h1>üìù My Exams</h1>
      <p>Manage your course exams and questions</p>
    </div>
    <button (click)="createExam()" class="btn-create">+ Create New Exam</button>
  </header>

  <!-- Course Selection -->
  @if (courses().length > 0) {
  <div class="course-selector">
    <label for="course-select">Select Course:</label>
    <div class="course-dropdown-container">
      <select
        id="course-select"
        name="selectedCourseId"
        [ngModel]="selectedCourseId()"
        (ngModelChange)="selectCourse($event)"
        class="form-select course-dropdown"
        aria-label="Select course"
      >
        @for (course of courses(); track course.courseId) {
        <option [value]="course.courseId">
          {{ course.title }}
        </option>
        }
      </select>
    </div>
  </div>
  }

  <!-- Loading State -->
  @if (loading()) {
  <div class="loading-state">
    <div class="spinner"></div>
    <p>Loading exams...</p>
  </div>
  }

  <!-- Error State -->
  @if (error() && !loading()) {
  <div class="error-state">
    <p>{{ error() }}</p>
    <button (click)="loadInstructorCourses()">Retry</button>
  </div>
  }

  <!-- Empty State - No Courses -->
  @if (!loading() && !error() && courses().length === 0) {
  <div class="empty-state">
    <div class="empty-icon">üìö</div>
    <h3>No Courses Yet</h3>
    <p>Create a course first before adding exams</p>
    <button (click)="goBack()" class="btn-primary">Go to Dashboard</button>
  </div>
  }

  <!-- Empty State - No Exams -->
  @if (!loading() && !error() && courses().length > 0 && exams().length === 0 && selectedCourseId())
  {
  <div class="empty-state">
    <div class="empty-icon">üìù</div>
    <h3>No Exams Yet</h3>
    <p>Create your first exam for this course</p>
    <button (click)="createExam()" class="btn-primary">Create Exam</button>
  </div>
  }

  <!-- Exams Grid -->
  @if (!loading() && !error() && exams().length > 0) {
  <div class="exams-grid">
    @for (exam of exams(); track exam.examId) {
    <div class="exam-card">
      <div class="exam-header">
        <h3>{{ exam.title }}</h3>
        <span class="questions-badge">{{ exam.questionsCount }} Questions</span>
      </div>

      <p class="exam-description">{{ exam.description }}</p>

      <div class="exam-meta">
        <div class="meta-item">
          <span class="meta-icon">‚è±Ô∏è</span>
          <span>{{ exam.durationMinutes }} min</span>
        </div>
        <div class="meta-item">
          <span class="meta-icon">üìä</span>
          <span>{{ exam.totalMarks }} marks</span>
        </div>
        <div class="meta-item">
          <span class="meta-icon">‚úÖ</span>
          <span>{{ exam.passingPercentage }}% to pass</span>
        </div>
      </div>

      <div class="exam-footer">
        <small class="created-date">Created: {{ exam.createdAt | date : 'short' }}</small>
        <div class="exam-actions">
          <!-- Button to toggle questions view -->
          <button (click)="toggleQuestions(exam.examId)" class="btn-toggle-questions">
            {{ expandedExamId() === exam.examId ? 'Hide Questions' : 'Show Questions' }}
          </button>

          <button (click)="manageQuestions(exam.examId)" class="btn-questions">Manage</button>
          <button (click)="editExam(exam.examId)" class="btn-edit">Edit</button>
          <button
            (click)="deleteExam(exam.examId)"
            [disabled]="deleting() === exam.examId"
            class="btn-delete"
          >
            {{ deleting() === exam.examId ? 'Deleting...' : 'Delete' }}
          </button>
        </div>
      </div>

      <!-- Questions List Section -->
      @if (expandedExamId() === exam.examId) {
      <div class="questions-section">
        @if (loadingQuestions()) {
        <div class="loading-questions">
          <div class="spinner-small"></div>
          Loading questions...
        </div>
        } @if (!loadingQuestions() && questionsMap().get(exam.examId)?.length === 0) {
        <div class="no-questions">
          <p>No questions added to this exam yet.</p>
        </div>
        } @if (!loadingQuestions() && (questionsMap().get(exam.examId) || []).length > 0) {
        <div class="questions-list">
          <h4>Questions</h4>
          @for (q of questionsMap().get(exam.examId); track q.questionId; let i = $index) {
          <div class="question-item">
            <div class="question-header">
              <span class="q-number">Q{{ i + 1 }}</span>
              <span class="q-type badge">{{ q.questionType }}</span>
              <span class="q-mark">{{ q.mark }} Marks</span>
            </div>

            <p class="question-text">{{ q.questionText }}</p>

            <!-- Options (for MCQ/TrueFalse) -->
            @if (q.options && q.options.length > 0) {
            <div class="question-options">
              @for (opt of q.options; track opt.optionId) {
              <div class="option-item" [class.correct]="opt.isCorrect">
                <span class="opt-check">{{ opt.isCorrect ? '‚úÖ' : '‚ö™' }}</span>
                <span>{{ opt.optionText }}</span>
              </div>
              }
            </div>
            }

            <!-- Helper for Text Answer -->
            @if (q.questionType === 'Text') {
            <div class="text-answer-helper">
              <strong>Correct Answer:</strong> {{ q.correctAnswer }}
            </div>
            }
          </div>
          }
        </div>
        }
      </div>
      }
    </div>
    }
  </div>
  }
</div>